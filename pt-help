#!/bin/bash

# Project Tracker Help System

PT_GUIDE="$HOME/.local/bin/pt-guide.md"

case "${1:-overview}" in
    "guide"|"doc"|"docs")
        if command -v mdcat >/dev/null 2>&1; then
            mdcat "$PT_GUIDE"
        elif command -v glow >/dev/null 2>&1; then
            glow "$PT_GUIDE"
        else
            cat "$PT_GUIDE"
        fi
        ;;
    "commands"|"cmd")
        echo "Project Tracker (pt) - Quick Command Reference"
        echo "=============================================="
        echo ""
        echo "PROJECT MANAGEMENT:"
        echo "  pt add-project <name> [-p path] [-d description]  Add new project"
        echo "  pt projects [-s status]                          List projects"
        echo "  pt status [project]                              Show status"
        echo ""
        echo "TASK MANAGEMENT:"
        echo "  pt add <project> \"<title>\" [-d desc] [-p priority] Add task"
        echo "  pt list [-p project] [-s status]                List tasks"
        echo "  pt start <task_id>                               Start task"
        echo "  pt complete <task_id>                            Complete task"
        echo "  pt block <task_id>                               Block task"
        echo ""
        echo "INTEGRATION:"
        echo "  pt-setup-git [project]                          Setup Git hooks"
        echo "  pt-enhance-claude <project|--all> [--backup]    Enhance CLAUDE.md"
        echo "  pt-dev start <project> [-t task_id]             Start dev session"
        echo "  pt-dev status                                   System status"
        echo "  pt-dev end                                      End dev session"
        echo ""
        echo "AI FEATURES:"
        echo "  pt-ai config [--api-key KEY]                    Configure Google AI"
        echo "  pt-ai add <project> \"<description>\"             Create task from natural language"
        echo "  pt-ai chat <project> \"<message>\"               Chat with AI about project"
        echo "  pt-ai analyze <task_id>                         AI analysis of task"
        echo "  pt-ai interactive <project>                     Interactive AI chat session"
        echo ""
        echo "HELP:"
        echo "  pt-help                                         This help"
        echo "  pt-help guide                                   Full user guide"
        echo "  pt-help git                                     Git integration help"
        ;;
    "git")
        echo "Git Integration Help"
        echo "==================="
        echo ""
        echo "Setup:"
        echo "  pt-setup-git                    # Setup all projects"
        echo "  pt-setup-git \"project-name\"    # Setup specific project"
        echo ""
        echo "Commit Message Patterns:"
        echo "  pt:123 completed                # Mark task as completed"
        echo "  pt:123 done                     # Mark task as completed"
        echo "  pt:123 progress                 # Mark task as in progress"
        echo "  pt:123 working                  # Mark task as in progress"
        echo "  pt:123 blocked                  # Mark task as blocked"
        echo "  pt:123                          # Log activity (no status change)"
        echo ""
        echo "Examples:"
        echo "  git commit -m \"Add user auth pt:45 completed\""
        echo "  git commit -m \"Working on payment gateway pt:89 progress\""
        echo "  git commit -m \"Database issue pt:12 blocked\""
        ;;
    "ai")
        echo "AI Integration Help"
        echo "==================="
        echo ""
        echo "Setup:"
        echo "  1. Get your Google AI Studio API key from: https://aistudio.google.com/apikey"
        echo "  2. Configure using ANY of these methods (in priority order):"
        echo "     • Global environment: export GOOGLE_AI_API_KEY=your_key"
        echo "     • Global ~/.env file: echo 'GOOGLE_AI_API_KEY=your_key' >> ~/.env"
        echo "     • Project .env file: Create .env in project directory"
        echo "     • Local config: pt-ai config --api-key YOUR_API_KEY"
        echo "  3. Test: pt-ai chat \"your-project\" \"hello\""
        echo ""
        echo "Features:"
        echo "  Natural Language Tasks:"
        echo "    pt-ai add \"my-project\" \"create REST API with authentication\""
        echo "    pt-ai add \"my-project\" \"implement user dashboard with charts\""
        echo ""
        echo "  Project Consultation:"
        echo "    pt-ai chat \"my-project\" \"how should I structure my database?\""
        echo "    pt-ai chat \"my-project\" \"best practices for error handling?\""
        echo ""
        echo "  Task Analysis:"
        echo "    pt-ai analyze 123    # Get AI insights on task 123"
        echo ""
        echo "  Interactive Mode:"
        echo "    pt-ai interactive \"my-project\"    # Start chat session"
        echo ""
        echo "The AI understands your project context including:"
        echo "  • Active and completed tasks"
        echo "  • Git commit history"
        echo "  • Project file structure"
        echo "  • Development patterns"
        ;;
    "overview"|*)
        echo "🛠️  Project Tracker (pt) - Overview"
        echo "===================================="
        echo ""
        echo "A comprehensive CLI project management system with:"
        echo "  • Task and project tracking"
        echo "  • Git integration with automatic updates"
        echo "  • Development session optimization"
        echo "  • Claude Code integration via enhanced CLAUDE.md"
        echo "  • AI-powered natural language task creation and analysis"
        echo "  • Integration with your existing performance scripts"
        echo ""
        echo "Quick Start:"
        echo "  pt add-project \"my-project\" -p \"/path/to/project\""
        echo "  pt add \"my-project\" \"First task\" -p high"
        echo "  pt-setup-git \"my-project\""
        echo "  pt-dev start \"my-project\""
        echo ""
        echo "Get Help:"
        echo "  pt-help commands           # Command reference"
        echo "  pt-help git               # Git integration help"
        echo "  pt-help ai                # AI features help"
        echo "  pt-help guide             # Full user guide"
        echo ""
        echo "Current Status:"
        pt status 2>/dev/null || echo "  Run 'pt projects' to see your projects"
        ;;
esac